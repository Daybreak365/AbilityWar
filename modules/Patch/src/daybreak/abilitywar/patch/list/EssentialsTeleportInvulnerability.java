package daybreak.abilitywar.patch.list;

import com.earth2me.essentials.Essentials;
import daybreak.abilitywar.patch.Patchable;
import org.bukkit.Bukkit;

import java.io.BufferedReader;
import java.io.File;
import java.io.FileOutputStream;
import java.io.FileReader;
import java.io.IOException;

class EssentialsTeleportInvulnerability implements Patchable {

	EssentialsTeleportInvulnerability() {}

	private final Essentials essentials = (Essentials) Bukkit.getPluginManager().getPlugin("Essentials");

	@Override
	public boolean isValid() {
		return essentials != null;
	}

	@Override
	public boolean isApplied() {
		return essentials.getSettings().getTeleportInvulnerability() == 0;
	}

	@Override
	public void apply() {
		final File file = new File(essentials.getDataFolder(), "config.yml");
		try (final BufferedReader reader = new BufferedReader(new FileReader(file))) {
			final StringBuilder lines = new StringBuilder();
			String line;
			while ((line = reader.readLine()) != null) {
				if (line.startsWith("teleport-invulnerability:")) line = "teleport-invulnerability: 0";
				lines.append(line);
				lines.append(System.lineSeparator());
			}

			try (FileOutputStream output = new FileOutputStream(file)) {
				output.write(lines.toString().getBytes());
			}
		} catch (IOException ignored) {}
		essentials.getSettings().reloadConfig();
	}

	@Override
	public String getName() {
		return "에센셜 텔레포트 무적";
	}

}
